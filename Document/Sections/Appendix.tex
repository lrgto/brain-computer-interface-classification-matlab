\newpage
\section*{Appendix A: SBJ1-15, S1-7 CNN Testing File}
\addcontentsline{toc}{section}{\protect\numberline{}Appendix A: SBJ1-15, S1-7 CNN Testing File}
\label{Appendix A: SBJ1-15, S1-7 CNN Testing File Section}

\begin{lstlisting}[language=matlab]
clc; clear all; close all; 
disp('SBJ00 S00:  RUNNING  | Starting CNN Test (SBJ1-15, S1-7)');
SBJS=fopen('/Users/mysftz/BCI/SBJ-S/AllSBJ-S.txt','r');
rt = tic; 
    
for i=1:105 
    clear S;
    S=fgetl(SBJS);         
    sub=S(1:5); sess=S(7:9); cellrange=S(11:13); matrixrange=S(15:end);
    
    load (strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/trainData.mat'));
    load (strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/testData.mat'));
    target=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/trainTargets.txt')); 
    label=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/testLabels.txt')); 
    event=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/testEvents.txt')); 
    runs=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/runs_per_block.txt'));
    
    [sess_accuracy, predicted_object] = BCI_CNN_Function(event, label, runs, sess, sub, target, testData, trainData);
    runtime=toc(rt); 
    
    writematrix(predicted_object, '/Users/mysftz/BCI/Results/CNN_Results_S1_7.xlsx', 'Range', matrixrange); 
    writematrix(sess_accuracy, '/Users/mysftz/BCI/Results/CNN_Accuracy_S1_7.xlsx', 'Range', cellrange); 
    writematrix(runtime, '/Users/mysftz/BCI/Results/CNN_RunTime_S1_7.xlsx', 'Range', cellrange); 
    disp([sub, ' ', num2str(sess), ': COMPLETED | ', num2str(sess_accuracy), '% Accuracy in ', num2str(runtime), 's']);
end
disp('SBJ00 S00:  ENDING   | Ending CNN Test (SBJ1-15, S1-7)'); 
fclose(SBJS); 
\end{lstlisting}

\newpage
\section*{Appendix B: SBJ1-15, S1-3 CNN Testing File}
\addcontentsline{toc}{section}{\protect\numberline{}Appendix B: SBJ1-15, S1-3 CNN Testing File}
\label{Appendix B: SBJ1-15, S1-3 CNN Testing File Section}

\begin{lstlisting}[language=matlab]
clc; clear all; close all; 
disp('SBJ00 S00:  RUNNING  | Starting CNN Test (SBJ1-15, S1-3)');
SBJS=fopen('/Users/mysftz/BCI/SBJ-S/SBJ1-15&S1-3.txt','r');
rt = tic; 
    
for i=1:45
    clear S;
    S=fgetl(SBJS);         
    sub=S(1:5); sess=S(7:9); cellrange=S(11:13); matrixrange=S(15:end);
    
    load (strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/trainData.mat'));
    load (strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/testData.mat'));
    target=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/trainTargets.txt')); 
    label=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/testLabels.txt')); 
    event=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/testEvents.txt')); 
    runs=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/runs_per_block.txt'));
    
    [sess_accuracy, predicted_object] = BCI_CNN_Function(event, label, runs, sess, sub, target, testData, trainData);
    runtime=toc(rt); 
    
    writematrix(predicted_object, '/Users/mysftz/BCI/Results/CNN_Results_S1_3.xlsx', 'Range', matrixrange); 
    writematrix(sess_accuracy, '/Users/mysftz/BCI/Results/CNN_Accuracy_S1_3.xlsx', 'Range', cellrange); 
    writematrix(runtime, '/Users/mysftz/BCI/Results/CNN_RunTime_S1_3.xlsx', 'Range', cellrange); 
    disp([sub, ' ', num2str(sess), ': COMPLETED | ', num2str(sess_accuracy), '% Accuracy in ', num2str(runtime), 's']);
end
disp('SBJ00 S00:  ENDING   | Ending CNN Test (SBJ1-15, S1-3)'); 
fclose(SBJS); 
\end{lstlisting}

\newpage
\section*{Appendix C: SBJ1-15, S4-7 CNN Testing File}
\addcontentsline{toc}{section}{\protect\numberline{}Appendix C: SBJ1-15, S4-7 CNN Testing File}
\label{Appendix C: SBJ1-15, S4-7 CNN Testing File Section}

\begin{lstlisting}[language=matlab]
clc; clear all; close all; 
disp('SBJ00 S00:  RUNNING  | Starting CNN Test (SBJ1-15, S4-7)');
SBJS=fopen('/Users/mysftz/BCI/SBJ-S/SBJ1-15&S4-7.txt','r');
rt = tic; 
    
for i=1:60
    clear S;
    S=fgetl(SBJS);         
    sub=S(1:5); sess=S(7:9); cellrange=S(11:13); matrixrange=S(15:end);
    
    load (strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/trainData.mat'));
    load (strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/testData.mat'));
    target=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/trainTargets.txt')); 
    label=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/testLabels.txt')); 
    event=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/testEvents.txt')); 
    runs=load(strcat('/Users/mysftz/BCI/Dataset/', sub, '/', sess, '/runs_per_block.txt'));
    
    [sess_accuracy, predicted_object] = BCI_CNN_Function(event, label, runs, sess, sub, target, testData, trainData);
    runtime=toc(rt); 
    
    writematrix(predicted_object, '/Users/mysftz/BCI/Results/CNN_Results_S4_7.xlsx', 'Range', matrixrange); 
    writematrix(sess_accuracy, '/Users/mysftz/BCI/Results/CNN_Accuracy_S4_7.xlsx', 'Range', cellrange); 
    writematrix(runtime, '/Users/mysftz/BCI/Results/CNN_RunTime_S4_7.xlsx', 'Range', cellrange); 
    disp([sub, ' ', num2str(sess), ': COMPLETED | ', num2str(sess_accuracy), '% Accuracy in ', num2str(runtime), 's']);
end
disp('SBJ00 S00:  ENDING   | Ending CNN Test (SBJ1-15, S4-7)'); 
fclose(SBJS); 
\end{lstlisting}

\newpage
\section*{Appendix D: CNN Function}
\addcontentsline{toc}{section}{\protect\numberline{}Appendix D: CNN Function}
\label{Appendix D: CNN Function Section}

\begin{lstlisting}[language=matlab]
function [sess_accuracy, predicted_object] = BCI_CNN_Function(event, label, runs, sess, sub, target, testData, trainData)

%PRE-PROCESSING:
% Pre-stimulus mean removal:
mn=mean(trainData(:,1:100,:),2);
trainDatamn=trainData-mn;

% Normalisation:
for j=1:1600
    for i=1:8
        datemp=trainDatamn(i,101:350,j);
        data(i,:,1,j)=normalize(datemp,'range');
    end
end

labeldata=categorical(target);

% COGNITIVE NEURAL NETWORK (CNN) LAYERS:
layers = [ ...
    imageInputLayer([8 250 1])

    convolution2dLayer(3,64,'Padding', 'same')
    batchNormalizationLayer
    reluLayer
    %dropoutlayer was originally here
    maxPooling2dLayer(2,'Stride',2)
    dropoutLayer(0.1)

    convolution2dLayer(3,32,'Padding', 'same')
    batchNormalizationLayer
    reluLayer
    %dropoutlayer was originally here
    maxPooling2dLayer(2,'Stride',2)
    dropoutLayer(0.1)
    
    convolution2dLayer(3,16,'Padding', 'same')
    batchNormalizationLayer
    reluLayer
    %dropoutlayer was originally here
    maxPooling2dLayer(2,'Stride',2)
    dropoutLayer(0.1)
    
    fullyConnectedLayer(128)
    reluLayer

    fullyConnectedLayer(2)
    softmaxLayer
    classificationLayer];

options = trainingOptions('sgdm', ... 
    'InitialLearnRate',0.0001, ...
    'MaxEpochs',30, ... 
    'Shuffle','every-epoch', ... 
    'Verbose',false, ... 
    'Plots','none'); 
    %'Momentum', 0.9000, ...  
    %'LearnRateSchedule', 'none', ...
    %'MiniBatchSize', 128, ... 
    %'gradientdecayfactor', 0.9% ...  

% TRAINING THE CNN:
[net,info] = trainNetwork(data, labeldata, layers, options);

flashes=8*runs;
blocks=50;
mn=mean(testData(:,1:100,:),2);
testDatamn=testData-mn;

%Normalise the data again
for j=1:blocks*flashes
    for i=1:8
        datempt=testDatamn(i,101:350,j);
        testdata(i,:,1,j)=normalize(datempt,'range');
    end
end

%Average probability sorting
[predicted, prob]= classify(net, testdata);

predicted_testevent=[event, prob]; 

%sorted method, averaged prob output
for i=1:blocks
sorted=sortrows(predicted_testevent((i-1)*flashes+1:i*flashes,:),1);
    for j=1:flashes/runs
    test_prediction(j,:)=median(sorted((j-1)*runs+1:j*runs,:));
    end
    [val, ind]=max(test_prediction);
    predicted_object(i)=ind(3);
end

success=0;
for i=1:blocks
    if (predicted_object(i)==label(i))
        success(i)=1;
    end
end

sess_accuracy=(sum(success)/blocks)*100;
\end{lstlisting}